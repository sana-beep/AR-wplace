<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wplace AR - View Above You</title>
    <script src="https://aframe.io/releases/1.4.2/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.3.2/aframe/build/aframe-ar.js"></script>
    <style>
      body {
        margin: 0;
        overflow: hidden;
        font-family: Arial, sans-serif;
      }
      #info-panel {
        position: fixed;
        top: 20px;
        left: 20px;
        background: rgba(0, 0, 0, 0.8);
        color: white;
        padding: 15px;
        border-radius: 10px;
        z-index: 1000;
        max-width: 300px;
      }
      #location-info {
        margin-bottom: 10px;
      }
      #wplace-data {
        font-size: 14px;
        line-height: 1.4;
      }
      .loading {
        color: #ffd700;
      }
      .error {
        color: #ff6b6b;
      }
    </style>
  </head>
  <body>
    <div id="info-panel">
      <div id="location-info">
        <strong>Location:</strong> <span id="coordinates">Getting location...</span>
      </div>
      <div id="wplace-data">
        <strong>Wplace Data:</strong> <span id="data-status">Loading...</span>
      </div>
    </div>

    <a-scene embedded arjs="sourceType: webcam; sourceWidth: 1280; sourceHeight: 960; displayWidth: 1280; displayHeight: 960;">

      <!-- AR content will be dynamically added here -->
      <a-entity id="ar-content"></a-entity>

      <!-- Camera entity -->
      <a-entity camera></a-entity>
    </a-scene>

    <script>
      let currentLocation = null;
      let wplaceData = null;

      // Get user's location
      function getLocation() {
        if (navigator.geolocation) {
          navigator.geolocation.getCurrentPosition(
            function(position) {
              currentLocation = {
                latitude: position.coords.latitude,
                longitude: position.coords.longitude
              };
              
              document.getElementById('coordinates').textContent = 
                `${currentLocation.latitude.toFixed(6)}, ${currentLocation.longitude.toFixed(6)}`;
              
              // Fetch wplace data for this location
              fetchWplaceData(currentLocation);
            },
            function(error) {
              console.error('Error getting location:', error);
              document.getElementById('coordinates').textContent = 'Location access denied';
              document.getElementById('data-status').textContent = 'Cannot fetch data without location';
            }
          );
        } else {
          document.getElementById('coordinates').textContent = 'Geolocation not supported';
        }
      }

      // Fetch data from wplace.live (you'll need to implement the actual API call)
      async function fetchWplaceData(location) {
        try {
          document.getElementById('data-status').innerHTML = '<span class="loading">Fetching wplace data...</span>';
          
          // This is a placeholder - you'll need to implement the actual API call to wplace.live
          // Example API call structure:
          // const response = await fetch(`https://wplace.live/api/location?lat=${location.latitude}&lng=${location.longitude}`);
          // wplaceData = await response.json();
          
          // For now, we'll simulate some data
          await new Promise(resolve => setTimeout(resolve, 2000)); // Simulate API delay
          wplaceData = {
            name: "Sample Location",
            description: "This is what's above you on wplace.live",
            type: "Building",
            height: "50m"
          };
          
          document.getElementById('data-status').innerHTML = 
            `<div>${wplaceData.name}</div><div>${wplaceData.description}</div>`;
          
          // Create AR content based on the data
          createARContent(wplaceData);
          
        } catch (error) {
          console.error('Error fetching wplace data:', error);
          document.getElementById('data-status').innerHTML = '<span class="error">Error loading data</span>';
        }
      }

      // Create AR content to display above the user
      function createARContent(data) {
        const arContent = document.getElementById('ar-content');
        arContent.innerHTML = ''; // Clear existing content
        
        // Create a floating text display above the camera
        const textEntity = document.createElement('a-text');
        textEntity.setAttribute('value', `${data.name}\n${data.description}`);
        textEntity.setAttribute('position', '0 2 -3');
        textEntity.setAttribute('align', 'center');
        textEntity.setAttribute('width', '4');
        textEntity.setAttribute('color', '#ffffff');
        textEntity.setAttribute('font', 'kelsonsans');
        
        arContent.appendChild(textEntity);
        
        // Add a background plane for better visibility
        const background = document.createElement('a-plane');
        background.setAttribute('position', '0 2 -3.1');
        background.setAttribute('width', '4.5');
        background.setAttribute('height', '1.5');
        background.setAttribute('color', '#000000');
        background.setAttribute('opacity', '0.7');
        
        arContent.appendChild(background);
      }

      // Initialize the app when the page loads
      window.addEventListener('load', function() {
        getLocation();
      });

      // Update location periodically (every 30 seconds)
      setInterval(getLocation, 30000);
    </script>
  </body>
</html>
